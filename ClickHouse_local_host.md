# Skript_CH

Развёртывание ClickHouse на Linux: пошаговое руководство
Это руководство поможет вам установить и базово настроить аналитическую СУБД ClickHouse на сервере под управлением Linux (на примере дистрибутивов, основанных на Debian, таких как Ubuntu).

1. Подготовка сервера (при необходимости)
Если у вас ещё нет сервера, рассмотрите варианты приобретения виртуальной машины (VDS). Важно учесть минимальные требования к ресурсам: ClickHouse требует как минимум 4 ГБ оперативной памяти .

Команды для подключения к серверу по SSH:

bash
ssh ваш_пользователь@IP_адрес_сервера
# Пример: ssh user@192.168.1.100
Комментарий: Выполните эту команду в терминале на вашем локальном компьютере, чтобы подключиться к удалённому серверу. Вместо ваш_пользователь укажите логин, предоставленный хостинг-провайдером (часто root или ubuntu), а вместо IP_адрес_сервера — IP-адрес вашей VDS.

2. Добавление официального репозитория ClickHouse
ClickHouse отсутствует в стандартных репозиториях большинства дистрибутивов, поэтому необходимо добавить официальный репозиторий ClickHouse .

Команды для добавления репозитория:

bash
# Установка необходимых пакетов для работы с HTTPS-репозиториями
sudo apt-get install apt-transport-https ca-certificates dirmngr -y
# Коментарий: `sudo` выполняет команду от имени суперпользователя. `-y` автоматически подтверждает установку.

# Добавление GPG-ключа репозитория для проверки подлинности пакетов
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 648ACFD622F3D138
# Коментарий: Этот шаг импортирует публичный ключ, который используется для проверки цифровой подписи пакетов из репозитория ClickHouse.

# Добавление строки репозитория в список источников пакетов
echo "deb https://repo.clickhouse.com/deb/stable/ main/" | sudo tee -a /etc/apt/sources.list.d/clickhouse.list
# Коментарий: Эта команда добавляет новую строку, указывающую apt, где искать пакеты ClickHouse. `tee -a` добавляет строку в конец файла.
3. Установка ClickHouse Server и Client
После добавления репозитория можно установить сам ClickHouse.

Команды для установки:

bash
# Обновление списка пакетов из всех репозиториев
sudo apt-get update
# Коментарий: Это обновляет локальный кэш пакетов, чтобы apt знал о новых пакетах из добавленного репозитория ClickHouse.

# Установка ClickHouse Server и ClickHouse Client
sudo apt-get install clickhouse-server clickhouse-client -y
# Коментарий: `clickhouse-server` - это сам сервер базы данных, а `clickhouse-client` - клиент для взаимодействия с ним из командной строки.
4. Запуск и проверка статуса ClickHouse Server
После установки необходимо запустить сервис ClickHouse и убедиться, что он работает корректно .

Команды для управления сервисом:

bash
# Запуск сервиса ClickHouse Server
sudo service clickhouse-server start
# Коментарий: Эта команда запускает сервер ClickHouse как системный сервис.

# Проверка статуса ClickHouse Server
sudo service clickhouse-server status
# Коментарий: Вы увидите статус "active (running)", если сервер успешно запущен.
Дополнительно: Чтобы ClickHouse автоматически запускался при старте системы:

bash
sudo systemctl enable clickhouse-server
# Коментарий: Включает автоматический запуск сервиса при каждой загрузке сервера.
5. Подключение к ClickHouse Client и выполнение первого запроса
Теперь, когда сервер запущен, можно подключиться к нему и проверить его работу .

Команда для подключения:

bash
clickhouse-client
# Коментарий: Эта команда запускает консольный клиент ClickHouse, который подключается к локальному серверу по умолчанию.
Пример первого запроса в клиенте:

sql
SELECT 'Hello, ClickHouse!';
# Коментарий: Простой запрос, чтобы убедиться, что сервер отвечает.
Выход из клиента:

sql
exit;
# Коментарий: Выход из интерфейса клиента ClickHouse.
6. Настройка доступа к ClickHouse (опционально, но рекомендуется)
По умолчанию ClickHouse слушает только локальные соединения (localhost). Если вы хотите подключаться к нему удалённо, необходимо изменить конфигурацию.

Редактирование конфигурационного файла:

bash
sudo nano /etc/clickhouse-server/config.xml
# Коментарий: Откроет основной конфигурационный файл сервера ClickHouse в текстовом редакторе nano. Вы также можете использовать `vi` или `vim`.
Изменение настройки listen_host:
Найдите строку:

xml
<listen_host>::</listen_host>
И измените её на:

xml
<listen_host>0.0.0.0</listen_host>
# Коментарий: Изменение `::` (IPv6 loopback) или `127.0.0.1` (IPv4 loopback) на `0.0.0.0` позволит ClickHouse слушать соединения со всех сетевых интерфейсов. Будьте внимательны: это открывает доступ извне.
Перезапуск сервера после изменений:

bash
sudo service clickhouse-server restart
# Коментарий: Изменения в конфигурации применяются только после перезапуска сервиса.
7. Настройка Firewall (опционально, но очень рекомендуется для безопасности)
Если вы открыли доступ к ClickHouse (listen_host на 0.0.0.0), крайне важно настроить файрвол, чтобы разрешить соединения только с доверенных IP-адресов. Стандартные порты ClickHouse: 8123 (HTTP) и 9000 (TCP) .

Команды для настройки ufw (для Ubuntu):

bash
# Разрешить SSH-соединения
sudo ufw allow ssh
# Коментарий: Убедитесь, что SSH разрешён, иначе вы рискуете потерять доступ к серверу.

# Разрешить подключения к ClickHouse по TCP (порт 9000)
sudo ufw allow 9000/tcp
# Коментарий: Этот порт используется для подключения `clickhouse-client` и большинства драйверов.

# Разрешить подключения к ClickHouse по HTTP (порт 8123)
sudo ufw allow 8123/tcp
# Коментарий: Этот порт используется для HTTP-API ClickHouse (например, для Grafana или веб-интерфейсов).

# Включить файрвол
sudo ufw enable
# Коментарий: Активирует правила файрвола. Вас могут спросить, хотите ли вы продолжить, введите `y`.

# Проверить статус файрвола
sudo ufw status
# Коментарий: Покажет список активных правил.
Комментарий: Для продакшен-среды рекомендуется разрешать доступ к портам ClickHouse только с конкретных IP-адресов, а не для всех. Например: sudo ufw allow from ваш_ip_адрес to any port 9000 proto tcp.

Следующие шаги:
Теперь ваш ClickHouse развёрнут и готов к работе. Вы можете создавать базы данных, таблицы, импортировать данные и выполнять аналитические запросы.

Важно: Для продакшен-среды рекомендуется изучить вопросы масштабирования, отказоустойчивости (репликация, ClickHouse Keeper), мониторинга и резервного копирования, как описано в официальной документации ClickHouse .

Вы можете скопировать этот текст в Markdown-файл (например, README.md или clickhouse_setup.md) в вашем локальном репозитории, а затем добавить его, сделать коммит и запушить на GitHub.
